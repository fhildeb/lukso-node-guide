"use strict";(self.webpackChunklukso_node_guide=self.webpackChunklukso_node_guide||[]).push([[1490],{1470:(e,n,s)=>{s.d(n,{A:()=>y});var r=s(6540),t=s(4164),a=s(3104),o=s(6347),l=s(205),i=s(7485),c=s(1682),d=s(679);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:s}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:s,default:r}})=>({value:e,label:n,attributes:s,default:r})))}(s);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const s=(0,o.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,i.aZ)(t),(0,r.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function g(e){const{defaultValue:n,queryString:s=!1,groupId:t}=e,a=u(e),[o,i]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:a}))),[c,h]=m({queryString:s,groupId:t}),[g,_]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,t]=(0,d.Dv)(n);return[s,(0,r.useCallback)((e=>{n&&t.set(e)}),[n,t])]}({groupId:t}),j=(()=>{const e=c??g;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{j&&i(j)}),[j]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),h(e),_(e)}),[h,_,a]),tabValues:a}}var _=s(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=s(4848);function b({className:e,block:n,selectedValue:s,selectValue:r,tabValues:o}){const l=[],{blockElementScrollPositionUntilNextRender:i}=(0,a.a_)(),c=e=>{const n=e.currentTarget,t=l.indexOf(n),a=o[t].value;a!==s&&(i(n),r(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=l.indexOf(e.currentTarget)+1;n=l[s]??l[0];break}case"ArrowLeft":{const s=l.indexOf(e.currentTarget)-1;n=l[s]??l[l.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},e),children:o.map((({value:e,label:n,attributes:r})=>(0,x.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...r,className:(0,t.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":s===e}),children:n??e},e)))})}function f({lazy:e,children:n,selectedValue:s}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function v(e){const n=g(e);return(0,x.jsxs)("div",{className:(0,t.A)("tabs-container",j.tabList),children:[(0,x.jsx)(b,{...n,...e}),(0,x.jsx)(f,{...n,...e})]})}function y(e){const n=(0,_.A)();return(0,x.jsx)(v,{...e,children:h(e.children)},String(n))}},6427:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"guides/monitoring/prometheus","title":"8.6 Prometheus","description":"Learn how to install, configure, and manage a local Prometheus server to monitor your LUKSO node with data from exporters like Node, JSON, and Blackbox Exporter.","source":"@site/docs/guides/monitoring/prometheus.md","sourceDirName":"guides/monitoring","slug":"/guides/monitoring/prometheus","permalink":"/docs/guides/monitoring/prometheus","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_label":"8.6 Prometheus","sidebar_position":6,"description":"Learn how to install, configure, and manage a local Prometheus server to monitor your LUKSO node with data from exporters like Node, JSON, and Blackbox Exporter."},"sidebar":"guidesSidebar","previous":{"title":"8.5 Blackbox Exporter","permalink":"/docs/guides/monitoring/blackbox-exporter"},"next":{"title":"8.7 Grafana","permalink":"/docs/guides/monitoring/grafana"}}');var t=s(4848),a=s(8453),o=s(1470),l=s(9365);const i={sidebar_label:"8.6 Prometheus",sidebar_position:6,description:"Learn how to install, configure, and manage a local Prometheus server to monitor your LUKSO node with data from exporters like Node, JSON, and Blackbox Exporter."},c="8.6 Prometheus",d={},h=[{value:"1. Create System User",id:"1-create-system-user",level:2},{value:"2. Install Prometeus",id:"2-install-prometeus",level:2},{value:"3. Dataset Configuration",id:"3-dataset-configuration",level:2},{value:"4. Service Configuration",id:"4-service-configuration",level:2},{value:"5. Start the Prometheus Service",id:"5-start-the-prometheus-service",level:2},{value:"6. Check Service Status",id:"6-check-service-status",level:2},{value:"Maintenance",id:"maintenance",level:2},{value:"Revert Setup",id:"revert-setup",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"86-prometheus",children:"8.6 Prometheus"})}),"\n",(0,t.jsxs)(n.p,{children:["Prometheus is a time-series database and monitoring system that collects, stores, and queries metrics from various sources like our previously set up ",(0,t.jsx)(n.a,{href:"/docs/guides/monitoring/node-exporter",children:"Node Exporter"}),", ",(0,t.jsx)(n.a,{href:"/docs/guides/monitoring/json-exporter",children:"JSON Exporter"}),", and ",(0,t.jsx)(n.a,{href:"/docs/guides/monitoring/blackbox-exporter",children:"Blackbox Exporter"}),". The guide explains how to set up the local Prometheus server and it's configuration to gather and unify all those metrics."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Further details about node analytics can be found on the ",(0,t.jsx)(n.a,{href:"/docs/theory/node-operation/monitoring-tools",children:(0,t.jsx)(n.strong,{children:"Monitoring Tools"})})," page in the \ud83e\udde0 ",(0,t.jsx)(n.a,{href:"/docs/theory/preparations/node-specifications",children:(0,t.jsx)(n.strong,{children:"Theory"})})," section."]})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["The following steps are performed on your \ud83d\udcdf ",(0,t.jsx)(n.strong,{children:"node server"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"1-create-system-user",children:"1. Create System User"}),"\n",(0,t.jsx)(n.p,{children:"Running services as a system user with minimal privileges is a best practice, limiting damage if compromised. The Blackbox Exporter user will only be able to read and execute service-specific files. Use the system's user creation tool to add a new one."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo adduser --system prometheus-worker --group --no-create-home\n"})}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Full Command Explanation"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Flag"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsxs)("nobr",{children:[" ",(0,t.jsx)(n.code,{children:"--system"})," "]})}),(0,t.jsx)(n.td,{children:"Creates a system user, used to run services and daemons rather than for people to log in with."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsxs)("nobr",{children:[" ",(0,t.jsx)(n.code,{children:"--group"})," "]})}),(0,t.jsx)(n.td,{children:"Creates a new group with the same name as the user."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsxs)("nobr",{children:[" ",(0,t.jsx)(n.code,{children:"--no-create-home"})," "]})}),(0,t.jsx)(n.td,{children:"Prevents creation of a home directory since the service does not need one."})]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"If you want to confirm that the user has been created, you can search for it within the password file, housing all essential information for each user account. Using the search tool grep, we can check if the user exists within the file."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'grep "prometheus-worker" /etc/passwd\n'})}),"\n",(0,t.jsx)(n.p,{children:"The output should look similar to this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"prometheus-worker:x:117:123::/home/prometheus-worker:/usr/sbin/nologin\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-install-prometeus",children:"2. Install Prometeus"}),"\n",(0,t.jsx)(n.p,{children:"To add the Prometheus tool to your node, you have to install it's package."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Depending on the ",(0,t.jsx)(n.a,{href:"https://github.com/prometheus/prometheus/releases/",children:"Current Prometheus Release"})," the version and filenames might differ. Please ensure to use the latest ",(0,t.jsx)(n.strong,{children:"LTS Release"})," for best security and stability. As of ",(0,t.jsx)(n.strong,{children:"July 2025"})," it is version ",(0,t.jsx)(n.strong,{children:"2.53.5"}),". A full list of versions and categorized releases can be viewed on the official ",(0,t.jsx)(n.a,{href:"https://prometheus.io/download/",children:"Prometheus Download Page"}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.1 Download Archive"}),": Move to the home directory and download the latest version."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd\nwget https://github.com/prometheus/prometheus/releases/download/v2.53.5/prometheus-2.53.5.linux-amd64.tar.gz\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.2 Extract Files"}),": Unpack the archive using Ubuntu\u2019s archiving tool."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"tar xzfv prometheus-2.53.5.linux-amd64.tar.gz\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"tar"})," command extracts ",(0,t.jsx)(n.code,{children:"x"})," the uncompressed ",(0,t.jsx)(n.code,{children:"z"})," archive from the file path ",(0,t.jsx)(n.code,{children:"f"})," using verbose ",(0,t.jsx)(n.code,{children:"v"})," status messages."]})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.3 Navigate into the Folder"}),": Move into the extracted archive to view the executables."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd prometheus-2.53.5.linux-amd64\nls -al\ncd\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["You will see ",(0,t.jsx)(n.strong,{children:"Promtool"})," and ",(0,t.jsx)(n.strong,{children:"Prometheus"})," showing up as executable programs that will both have to be installed."]}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Tool"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"prometheus"})}),(0,t.jsx)(n.td,{children:"The main Prometheus server that scrapes and stores metrics, and exposes it's database for querying."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"promtool"})}),(0,t.jsx)(n.td,{children:"The utility tool used for validating, and debugging Prometheus configuration files and alerting rules."})]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.4 Move Binary to System Path"}),": Move the Promtool and Prometheus binaries to your system path."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo cp prometheus /usr/local/bin/\nsudo cp promtool /usr/local/bin/\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.5 Set Ownership and Permissions"}),": Set the correct owner and access rights."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo chown -R prometheus-worker:prometheus-worker /usr/local/bin/prometheus\nsudo chown -R prometheus-worker:prometheus-worker /usr/local/bin/promtool\nsudo chmod 755 /usr/local/bin/prometheus\nsudo chmod 755 /usr/local/bin/promtool\n"})}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Full Command Descriptions"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Setting"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Description"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsxs)("nobr",{children:[" ",(0,t.jsx)(n.code,{children:"sudo chown <user>:<user> <directory>"})," "]})}),(0,t.jsx)(n.td,{children:"Assign ownership to a single folder or file."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsxs)("nobr",{children:[" ",(0,t.jsx)(n.code,{children:"sudo chmod 755 <directory>"})," "]})}),(0,t.jsx)(n.td,{children:"Set readable permissions for everyone, typically for general files."})]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2.6 Cleanup Installation Files"}),": Delete leftover archive and extracted folder."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"rm -rf prometheus-2.53.5.linux-amd64\nrm prometheus-2.53.5.linux-amd64.tar.gz\n"})}),"\n",(0,t.jsx)(n.h2,{id:"3-dataset-configuration",children:"3. Dataset Configuration"}),"\n",(0,t.jsx)(n.p,{children:"After the executables have been set up, you must create a separate configuration file for the Prometheus server to collect all of the exporter's information, and specify where to scrape, how often to scrape, and how what to do with the data."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"3.1 Create Necessary Directories"}),": Create all folders to exclude permission errors during operation."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo mkdir -p /etc/prometheus/console_libraries /etc/prometheus/consoles /etc/prometheus/files_sd /etc/prometheus/rules /etc/prometheus/rules.d /var/lib/prometheus\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"If folders already exist, they remain untouched. Otherwise, an empty folder will be created."})}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Full Folder Descriptions"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Path"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/etc/prometheus/console_libraries"})}),(0,t.jsx)(n.td,{children:"Shared library snippets used by console dashboards."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/etc/prometheus/consoles"})}),(0,t.jsx)(n.td,{children:"Web UI dashboard templates rendered on the Prometheus server."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/etc/prometheus/files_sd"})}),(0,t.jsx)(n.td,{children:"File-based discovery configs for port metrics."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/etc/prometheus/rules"})}),(0,t.jsx)(n.td,{children:"Custom alerting and recording rule files."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/etc/prometheus/rules.d"})}),(0,t.jsx)(n.td,{children:"Subdirectory for service rules like the validator, node, and ping checks."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/var/lib/prometheus"})}),(0,t.jsx)(n.td,{children:"Storage folder for all collected metrics."})]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"3.2 Create Config File"}),": Create a Prometheus configuration using your preferred text editor."]}),"\n",(0,t.jsxs)(o.A,{groupId:"editor",children:[(0,t.jsx)(l.A,{value:"vim",label:"Vim",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo vim /etc/prometheus/prometheus.yaml\n"})})}),(0,t.jsx)(l.A,{value:"nano",label:"Nano",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo nano /etc/prometheus/prometheus.yaml\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"3.3 Paste Configuration"}),": Add the settings and exporter jobs to the configuration structure based on your client and currency."]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:"All properties will later on be used within the Grafana Dashboard to fetch the token prices and build metrics based on your node. The Prometheus data endpoints include the following sources:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prometheus"}),": Compiling All Data Sources and Database Storage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consensus Client"}),": Validator Count, Uptime, Connection, Participation Rate"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Node Exporter"}),": Storage Demand, Processor Utilization, Heat Distribution, Disk Utilization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Blackbox Exporter"}),": Google and Cloudflare Pings, Latency Checks, Network Uptime"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"JSON Exporter"}),": Daily and Weekly Income, Staking Position, Market Behaviour"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validator Client"}),": Attestations and Proposals"]}),"\n"]})]}),"\n",(0,t.jsxs)(o.A,{groupId:"currency",children:[(0,t.jsx)(l.A,{value:"euro",label:"EUR",default:!0,children:(0,t.jsxs)(o.A,{groupId:"client",children:[(0,t.jsx)(l.A,{value:"teku",label:"Teku",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8008']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8009']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=eur\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"nimbus",label:"Nimbus-Eth2",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'beacon-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8008']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=eur\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"lighthouse",label:"Lighthouse",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:5054']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:5057']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=eur\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"prysm",label:"Prysm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8080']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8081']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=eur\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})})]})}),(0,t.jsx)(l.A,{value:"usd",label:"USD",children:(0,t.jsxs)(o.A,{groupId:"client",children:[(0,t.jsx)(l.A,{value:"teku",label:"Teku",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8008']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8009']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=usd\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"nimbus",label:"Nimbus-Eth2",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'beacon-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8008']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=usd\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"lighthouse",label:"Lighthouse",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:5054']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:5057']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=usd\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})}),(0,t.jsx)(l.A,{value:"prysm",label:"Prysm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'consensus-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8080']\n  - job_name: 'node-exporter-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator-client-job'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8081']\n  - job_name: 'google-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'cloudflare-ping-job'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'json-exporter-job'\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: 'json'\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=usd\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n"})})})]})})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["As shown in the ",(0,t.jsx)(n.a,{href:"/docs/guides/monitoring/port-configuration",children:(0,t.jsx)(n.strong,{children:"Port Configuration"})}),", ",(0,t.jsx)(n.strong,{children:"Nimbus-Eth2"})," exposes the consensus and validator data through one single port. Therefore the Prometheus configuration combines both, the ",(0,t.jsx)(n.code,{children:"consensus-client-job"})," and the ",(0,t.jsx)(n.code,{children:"validator-client-job"})," into a single ",(0,t.jsx)(n.code,{children:"beacon-client-job"})," instance."]})}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Global Settings and Scrape Parameter Descriptions"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Setting"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scrape_interval"})}),(0,t.jsxs)(n.td,{children:["How often Prometheus collects data from all targets, usually every ",(0,t.jsx)(n.code,{children:"15s"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"evaluation_interval"})}),(0,t.jsxs)(n.td,{children:["How often recording or alerting rules are evaluated, usually every ",(0,t.jsx)(n.code,{children:"15s"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"job_name"})}),(0,t.jsx)(n.td,{children:"Identifier for each target group that listens to a local port."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metrics_path"})}),(0,t.jsxs)(n.td,{children:["Path where metrics are exposed, usually ",(0,t.jsx)(n.code,{children:"/metrics"})," or ",(0,t.jsx)(n.code,{children:"/probe"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"params"})}),(0,t.jsx)(n.td,{children:"Used in Blackbox or JSON Exporter to pass query strings or URLs"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"static_configs"})}),(0,t.jsxs)(n.td,{children:["List of targets to scrape, like the ",(0,t.jsx)(n.code,{children:"host:port"})," of each service."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"relabel_configs"})}),(0,t.jsx)(n.td,{children:"Modified target labels, that map addresses to Blackbox or set an instance name."})]})]})]})]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Full Prometheus Job Descriptions"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Job Name"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"prometheus-job"})}),(0,t.jsx)(n.td,{children:"Scrapes internal metrics from the Prometheus server itself."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"consensus-client-job"})}),(0,t.jsx)(n.td,{children:"Collects blockchain metrics from the consensus client."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"validator-client-job"})}),(0,t.jsx)(n.td,{children:"Pulls activity and performance data from the validator client."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"beacon-client-job"})}),(0,t.jsx)(n.td,{children:"Collects blockchain metrics from the consensus and validator client."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"node-exporter-job"})}),(0,t.jsx)(n.td,{children:"Gathers hardware and OS metrics from the node using Node Exporter."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"google-ping-job"})}),(0,t.jsx)(n.td,{children:"Uses Blackbox Exporter to probe Google DNS."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"cloudflare-ping-job"})}),(0,t.jsx)(n.td,{children:"Uses Blackbox Exporter to probe Cloudflare DNS."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"json-exporter-job"})}),(0,t.jsx)(n.td,{children:"Gathers staking metrics and API data from the JSON Exporter."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"json"})}),(0,t.jsx)(n.td,{children:"Sends requests to CoinGecko API through JSON Exporter for LYX price data."})]})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"Ensure the correct formatting of double-spaces so that the Prometheus server functions correctly."})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"3.4 Restrict Permissions"}),": Change the ownership and restrict execution within configuration folders to the service user."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# Prometheus Configuration, Files, Logging\nsudo chown -R prometheus-worker:prometheus-worker /etc/prometheus\n\n# Prometheus Database\nsudo chown -R prometheus-worker:prometheus-worker /var/lib/prometheus\nsudo chmod 755 /var/lib/prometheus\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-service-configuration",children:"4. Service Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Once the software and dataset configuration are in place, we can create a service configuration, so it automatically starts during boot and restarts during crashes. The configuration will also check for logging and an internet connection before it starts up and uses the previously created user."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"4.1 Create Service File"}),": Create a system service file using your preferred text editor."]}),"\n",(0,t.jsxs)(o.A,{groupId:"editor",children:[(0,t.jsx)(l.A,{value:"vim",label:"Vim",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo vim /etc/systemd/system/prometheus.service\n"})})}),(0,t.jsx)(l.A,{value:"nano",label:"Nano",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo nano /etc/systemd/system/prometheus.service\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"4.2 Add Configuration"}),": Paste the following content using your preferred logging tool, then save and exit the file."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Further details on Journal and System Logging can be found on the ",(0,t.jsx)(n.a,{href:"/docs/theory/node-operation/utility-tools",children:(0,t.jsx)(n.strong,{children:"Utility Tools"})})," page in the the \ud83e\udde0 ",(0,t.jsx)(n.a,{href:"/docs/theory/preparations/node-specifications",children:(0,t.jsx)(n.strong,{children:"Theory"})})," section."]})}),"\n",(0,t.jsxs)(o.A,{groupId:"logging-tool",children:[(0,t.jsx)(l.A,{value:"journal",label:"Journal Logging",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"[Unit]\nDescription=Prometheus\nDocumentation=https://github.com/prometheus/prometheus\nWants=network-online.target\nAfter=network.target network-online.target\n\n[Service]\nUser=prometheus-worker\nGroup=prometheus-worker\nType=simple\nExecStart=/usr/local/bin/prometheus                               \\\n    --config.file /etc/prometheus/prometheus.yaml                 \\\n    --storage.tsdb.path /var/lib/prometheus/                      \\\n    --storage.tsdb.retention.time=31d                             \\\n    --web.console.templates=/etc/prometheus/consoles              \\\n    --web.console.libraries=/etc/prometheus/console_libraries\nExecReload=/bin/kill -HUP $MAINPIDRestart=always\nRestartSec=5\nSyslogIdentifier=prometheus\nStandardOutput=journal\nStandardError=journal\nProtectSystem=full\nNoNewPrivileges=true\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n"})})}),(0,t.jsx)(l.A,{value:"system",label:"System Logging",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"[Unit]\nDescription=Prometheus\nDocumentation=https://github.com/prometheus/prometheus\nWants=network-online.target\nAfter=network.target network-online.target\n\n[Service]\nUser=prometheus-worker\nGroup=prometheus-worker\nType=simple\nExecStart=/usr/local/bin/prometheus                               \\\n    --config.file /etc/prometheus/prometheus.yaml                 \\\n    --storage.tsdb.path /var/lib/prometheus/                      \\\n    --storage.tsdb.retention.time=31d                             \\\n    --web.console.templates=/etc/prometheus/consoles              \\\n    --web.console.libraries=/etc/prometheus/console_libraries\nExecReload=/bin/kill -HUP $MAINPIDRestart=always\nRestartSec=5\nSyslogIdentifier=prometheus\nStandardOutput=syslog\nStandardError=syslog\nProtectSystem=full\nNoNewPrivileges=true\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n"})})})]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Full Property Explanation"}),(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Description"})}),(0,t.jsxs)(n.td,{children:["A human-readable description of the service shown in ",(0,t.jsx)(n.code,{children:"systemctl status"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Documentation"})}),(0,t.jsx)(n.td,{children:"Link to documentation of the software that is being used for this service file."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Wants"})}),(0,t.jsxs)(n.td,{children:["The service should try to start ",(0,t.jsx)(n.code,{children:"network-online.target"})," before starting Prometheus."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"After"})}),(0,t.jsxs)(n.td,{children:["- ",(0,t.jsx)(n.code,{children:"network.target"}),": Ensures networking setup enabled before service is started. ",(0,t.jsx)("br",{})," - ",(0,t.jsx)(n.code,{children:"network-online.target"}),": Waits for network to be fully online before service is started."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User"})}),(0,t.jsxs)(n.td,{children:["Executes the service as the ",(0,t.jsx)(n.code,{children:"json-exporter-worker"})," user."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Group"})}),(0,t.jsxs)(n.td,{children:["Executes the service under the ",(0,t.jsx)(n.code,{children:"json-exporter-worker"})," group."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Type"})}),(0,t.jsxs)(n.td,{children:["Indicates running at a ",(0,t.jsx)(n.code,{children:"simple"})," service in the foreground without forking."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ExecStart"})}),(0,t.jsxs)(n.td,{children:["- Link to binary at ",(0,t.jsx)(n.code,{children:"/usr/local/bin/prometheus"}),", started with the terminal command."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ExecReload"})}),(0,t.jsxs)(n.td,{children:["Sends a ",(0,t.jsx)(n.code,{children:"kill"})," signal to the main process to restart and re-read all configuration files."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RestartSec"})}),(0,t.jsx)(n.td,{children:"Delay in seconds before restarting the service."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SyslogIdentifier"})}),(0,t.jsxs)(n.td,{children:["Tags logs from the service with ",(0,t.jsx)(n.code,{children:"json_exporter"})," to help distinguish them."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"StandardOutput"})}),(0,t.jsx)(n.td,{children:"Sends regular service logs to the journal or syslog system."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"StandardError"})}),(0,t.jsx)(n.td,{children:"Sends error service logs to the journal or syslog system."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ProtectSystem"})}),(0,t.jsx)(n.td,{children:"Restricts filesystem write access outside of the service runtime."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NoNewPrivileges"})}),(0,t.jsx)(n.td,{children:"Prevents privilege escalation which processes can be apply for."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PrivateTmp"})}),(0,t.jsxs)(n.td,{children:["Creates an isolated ",(0,t.jsx)(n.code,{children:"/tmp"})," directory for the service."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WantedBy"})}),(0,t.jsxs)(n.td,{children:["Binds the service to the ",(0,t.jsx)(n.code,{children:"multi-user.target"}),", so it starts during all boot processes."]})]})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["If you renamed the user, make sure to update both ",(0,t.jsx)(n.code,{children:"User"})," and ",(0,t.jsx)(n.code,{children:"Group"})," values to prevent running the service as ",(0,t.jsx)(n.code,{children:"root"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"5-start-the-prometheus-service",children:"5. Start the Prometheus Service"}),"\n",(0,t.jsx)(n.p,{children:"After setting up the service, you can enable and start the system service."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"5.1 Reload Daemon"}),": Reload the system daemon to include the new service."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"5.2 Start Service"}),": Start the Prometheus service using the system control."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl start prometheus\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"5.3 Enable Autostart on Boot"}),": Enable the service to start automatically during boot."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl enable prometheus\n"})}),"\n",(0,t.jsx)(n.p,{children:"The output should look similar to this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"Created symlink /etc/systemd/system/multi-user.target.wants/prometheus.service \u2192 /etc/systemd/system/prometheus.service.\n"})}),"\n",(0,t.jsx)(n.h2,{id:"6-check-service-status",children:"6. Check Service Status"}),"\n",(0,t.jsx)(n.p,{children:"You can fetch the current status from the system control to check if the Prometheus service is running and configured correctly. The command will display whether it is active, enabled, or disabled and show recent log entries."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl status prometheus\n"})}),"\n",(0,t.jsx)(n.p,{children:"The output should look similar to this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"\u25cf prometheus.service - Prometheus\n     Loaded: loaded (/etc/systemd/system/prometheus.service; enabled; vendor preset: enabled)\n     Active: active (running) since [DATE] UTC; [TIME] ago\n       Docs: https://github.com/prometheus/prometheus\n   Main PID: 29468 (prometheus)\n      Tasks: 17 (limit: 38043)\n     Memory: 27.4M\n        CPU: 293ms\n     CGroup: /system.slice/prometheus.service\n             \u2514\u250029468 /usr/local/bin/prometheus --config.file /etc/prometheus/prometheus.yaml --storage.ts>\n\n[DATE] [TIME] [USER] prometheus[29468]: ts=2023-05-18T09:43:54.539Z caller=head.go:536 level=info > ...\n...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"maintenance",children:"Maintenance"}),"\n",(0,t.jsx)(n.p,{children:"Proper maintenance ensures that all the components are working as intended and can be updated on the fly."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Logging"}),": Check the latest status of the system service."]}),"\n",(0,t.jsxs)(o.A,{groupId:"logging-tool",children:[(0,t.jsx)(l.A,{value:"journal",label:"Journal Logging",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo journalctl -f -u prometheus\n"})})}),(0,t.jsx)(l.A,{value:"system",label:"System Logging",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo tail -f /var/log/syslog | grep prometheus\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Restarting"}),": If you made any changes or updates to configuration, reload the system daemon and start the exporter."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl daemon-reload\nsudo systemctl restart prometheus\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Stopping"}),": You can stop the exporter using the system control."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl stop prometheus\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Further information about system control or logging can be found on the ",(0,t.jsx)(n.a,{href:"/docs/theory/node-operation/utility-tools",children:(0,t.jsx)(n.strong,{children:"Utility Tools"})})," page in the \ud83e\udde0 ",(0,t.jsx)(n.a,{href:"/docs/theory/preparations/node-specifications",children:(0,t.jsx)(n.strong,{children:"Theory"})})," section."]})}),"\n",(0,t.jsx)(n.h2,{id:"revert-setup",children:"Revert Setup"}),"\n",(0,t.jsx)(n.p,{children:"If something went wrong, you can remove the user or delete the service and related files all together."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"1. Stop and Disable Service"}),": Stop the tool and remove it's service link from the system's boot."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo systemctl stop prometheus\nsudo systemctl disable prometheus\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"2. Change Binary Ownership"}),": Change the owner of the Prometheus and Promtool executables."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo chown -R root:root /usr/local/bin/prometheus\nsudo chown -R root:root /usr/local/bin/promtool\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"3. Change Folder Ownership"}),": Change the owner of the configuration and database folers."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo chown -R root:root /etc/prometheus\nsudo chown -R root:root /var/lib/prometheus\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"4. Remove the Service and Config Files"}),": Delete all service files and reload the system daemon."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo rm /etc/systemd/system/prometheus.service\nsudo rm -rf /etc/prometheus\nsudo rm -rf /var/lib/prometheus/\nsudo systemctl daemon-reload\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"5. Delete Binary"}),": Remove the executable Prometheus and Promtool from your system."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo rm -rf /usr/local/bin/prometheus\nsudo rm -rf /usr/local/bin/promtool\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"6. Remove User and Group"}),": Prune the user and all it's cached configurations."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"sudo deluser --remove-all-files prometheus-worker\nsudo delgroup prometheus-worker\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const t={},a=r.createContext(t);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},9365:(e,n,s)=>{s.d(n,{A:()=>o});s(6540);var r=s(4164);const t={tabItem:"tabItem_Ymn6"};var a=s(4848);function o({children:e,hidden:n,className:s}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(t.tabItem,s),hidden:n,children:e})}}}]);