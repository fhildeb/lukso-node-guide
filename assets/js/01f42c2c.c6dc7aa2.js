"use strict";(self.webpackChunklukso_node_guide=self.webpackChunklukso_node_guide||[]).push([[3444],{44:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-15-1cbb74cdebaadb50f9392dc3d1f3cbf3.png"},685:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-9-a867d23e19a708bbdb7c0f6da6dcc07f.png"},740:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-8-f31e3d59cee48af53db57a90b7be36db.png"},826:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-6-78b0ae31f622396ba0c5a9afd03ac363.png"},993:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-5-b77530a6557739d2aa00dc8ec5e49610.png"},1171:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"guides/alert-systems/grafana-notifications","title":"9.2 Grafana Notifications","description":"This page is currently under maintenance reworked and contains outdated content.","source":"@site/docs/guides/alert-systems/grafana-notifications.md","sourceDirName":"guides/alert-systems","slug":"/guides/alert-systems/grafana-notifications","permalink":"/docs/guides/alert-systems/grafana-notifications","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"9.2 Grafana Notifications","sidebar_position":2},"sidebar":"guidesSidebar","previous":{"title":"9.1 Telegram Bot","permalink":"/docs/guides/alert-systems/telegram-bot"},"next":{"title":"9.3 Image Rendering","permalink":"/docs/guides/alert-systems/image-rendering"}}');var t=n(4848),o=n(8453);const i={sidebar_label:"9.2 Grafana Notifications",sidebar_position:2},r="9.2 Grafana Notifications",l={},c=[{value:"1. Add Notifications to Metrics",id:"1-add-notifications-to-metrics",level:2},{value:"2. Set Metrics Presets",id:"2-set-metrics-presets",level:2},{value:"Consensus Process Down",id:"consensus-process-down",level:4},{value:"Validator Process Down",id:"validator-process-down",level:4},{value:"Consensus Process Restarted",id:"consensus-process-restarted",level:4},{value:"Validator Process Restarted",id:"validator-process-restarted",level:4},{value:"Below 40 Peers",id:"below-40-peers",level:4},{value:"Participation Rate below 80%",id:"participation-rate-below-80",level:4},{value:"50 Slots Behind",id:"50-slots-behind",level:4},{value:"No Hourly Earnings",id:"no-hourly-earnings",level:4},{value:"Less than 2GB Free Memory",id:"less-than-2gb-free-memory",level:4},{value:"CPU Usage above 40%",id:"cpu-usage-above-40",level:4},{value:"Disk Usage above 60%",id:"disk-usage-above-60",level:4},{value:"CPU Temperature above 75 \xb0C",id:"cpu-temperature-above-75-c",level:4},{value:"Google Ping above 30ms",id:"google-ping-above-30ms",level:4},{value:"1. Configuring Notfication Intervals",id:"1-configuring-notfication-intervals",level:2}];function d(e){const s={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"92-grafana-notifications",children:"9.2 Grafana Notifications"})}),"\n",(0,t.jsx)(s.admonition,{type:"danger",children:(0,t.jsx)(s.p,{children:"This page is currently under maintenance reworked and contains outdated content."})}),"\n",(0,t.jsx)(s.h2,{id:"1-add-notifications-to-metrics",children:"1. Add Notifications to Metrics"}),"\n",(0,t.jsx)(s.p,{children:"In order to make sure that the node notifies you if some process is down, follow these steps. If something is unclear, you can have a look at the picture of each alert down below."}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"Make sure to get the latest dashboard of this guide, before continuing."}),"\n"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Click the Granfana Icon to get to the landing page."}),"\n",(0,t.jsx)(s.li,{children:"Click the LUKSO Dashboard."}),"\n",(0,t.jsxs)(s.li,{children:["Scroll down to the dashboard's ",(0,t.jsx)(s.code,{children:"Alerts"})," section."]}),"\n",(0,t.jsxs)(s.li,{children:["Select each alert and click ",(0,t.jsx)(s.code,{children:"Edit"})," on the 3-dot-menu."]}),"\n",(0,t.jsxs)(s.li,{children:["Within the ",(0,t.jsx)(s.code,{children:"Alert"})," tab, select ",(0,t.jsx)(s.code,{children:"Create alert rule from this panel"})," if you do not already see a alert panel on the page that you can click on. Do not worry if you need to create it first, as this is the default behavior since you will have to create folders and groups first."]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.code,{children:"Preview"})," to print out the graph to evaluate metric numbers."]}),"\n",(0,t.jsxs)(s.li,{children:["Adjust the ",(0,t.jsx)(s.code,{children:"Threshold"})," section to your likings on when the alert should happen."]}),"\n",(0,t.jsxs)(s.li,{children:["In case the ",(0,t.jsx)(s.code,{children:"Reduce"})," section is showing multiple lines and one of them is ",(0,t.jsx)(s.code,{children:"NaN"}),", set ",(0,t.jsx)(s.code,{children:"Replace Non-numeric Values"})," with a custom number above the alert range. For single line metrics that rely on clients or the network, its recommended to set a ",(0,t.jsx)(s.code,{children:"NaN"})," number within the alert range, meaning that an alert is sent when the process or network is currently down."]}),"\n",(0,t.jsxs)(s.li,{children:["Within the ",(0,t.jsx)(s.code,{children:"Alert evaluation behavior"})," section, add a ",(0,t.jsx)(s.code,{children:"node-alerts"})," folder where all the alert data will be stored. If it is already existing, select it from the panel. You can change the name of the folder of your likings, it is just to group alert's data. Its recommended to always choose the same name for one network, node or validator, so you do not mix up various targets and dashboards."]}),"\n",(0,t.jsxs)(s.li,{children:["Within the ",(0,t.jsx)(s.code,{children:"Evaluation group"})," selection, add a ",(0,t.jsx)(s.code,{children:"node-group"}),". If it is already existing, select it from the panel. You can change the name of the group of your likings, it is just to group alert's data. Its recommended to always choose the same name for one network, node or validator, so you do not mix up various targets and dashboards."]}),"\n",(0,t.jsxs)(s.li,{children:["Scroll up and click ",(0,t.jsx)(s.code,{children:"Save"})]}),"\n",(0,t.jsx)(s.li,{children:"Repeat this for every Alert on the Dashboard."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"2-set-metrics-presets",children:"2. Set Metrics Presets"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Grafana Alert Board",src:n(7333).A+"",width:"1697",height:"819"})}),"\n",(0,t.jsx)(s.p,{children:"Here are some example metrics that are included in the default dashboard. You can check the picures and validate if everything is configured the same way as in the guide."}),"\n",(0,t.jsx)(s.h4,{id:"consensus-process-down",children:"Consensus Process Down"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"1: Process up\n0: Process down\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Consensus Process Down Metric",src:n(7601).A+"",width:"1391",height:"833"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'up{job="consensus-client-job"}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"validator-process-down",children:"Validator Process Down"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"1: Process up\n0: Process down\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Validator Process Down Metric",src:n(8295).A+"",width:"1391",height:"833"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'up{job="validator-client-job"}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"consensus-process-restarted",children:"Consensus Process Restarted"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"1:   Process up\n0:   Process down\nNaN: Not available (likely down --\x3e 0)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Consensus Process Restarted Metric",src:n(3128).A+"",width:"1391",height:"833"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'(time()-process_start_time_seconds{job="consensus-client-job"})/3600\n'})}),"\n",(0,t.jsx)(s.h4,{id:"validator-process-restarted",children:"Validator Process Restarted"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"1:   Process up\n0:   Process down\nNaN: Not available (likely down --\x3e 0)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Validator Process Restarted Metric",src:n(993).A+"",width:"1391",height:"833"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'(time()-process_start_time_seconds{job="validator-client-job"})/3600\n'})}),"\n",(0,t.jsx)(s.h4,{id:"below-40-peers",children:"Below 40 Peers"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 30: Ideal healthy connections\nbelow 30: Resyncing or weak connections\nNaN:      Not available (no connections --\x3e 0)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Below 40 Peers Metric",src:n(826).A+"",width:"1391",height:"833"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'p2p_peer_count{state="Connected",job="consensus-client-job"}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"participation-rate-below-80",children:"Participation Rate below 80%"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 80: Ideal healthy network\nbelow 80: Unstable network\nNaN:      2nd data feed (ignore metric --\x3e 100)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Participation Rate below 80% Metric",src:n(8403).A+"",width:"1391",height:"862"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"beacon_prev_epoch_target_gwei / beacon_prev_epoch_active_gwei * 100\n"})}),"\n",(0,t.jsx)(s.h4,{id:"50-slots-behind",children:"50 Slots Behind"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"below 50: Ideal syncing speed\nabove 50: Unstable syncing\nNaN:      Not available (likely unstable --\x3e 51)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"50 Slots Behind Metric",src:n(740).A+"",width:"1391",height:"862"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"beacon_clock_time_slot-beacon_head_slot\n"})}),"\n",(0,t.jsx)(s.h4,{id:"no-hourly-earnings",children:"No Hourly Earnings"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 0,0001: Earning rewards\nbelow 0,0001: Syncing or negative rewards\nNaN:          Not available (likely negative rewards --\x3e 0)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"No Hourly Earnings Metric",src:n(685).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"sum(validator_balance) - sum(validator_balance offset 1h) - count(validator_balance > 16)*32 + count(validator_balance offset 1h > 0)*32\n"})}),"\n",(0,t.jsx)(s.h4,{id:"less-than-2gb-free-memory",children:"Less than 2GB Free Memory"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 2000000000: More than 2GB remaining\nbelow 2000000000: Less than 2GB remaining\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Less than 2GB Free Memory Metric",src:n(9505).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'(node_memory_MemFree_bytes{job="node-exporter-job"} or node_memory_MemFree{job="node-exporter-job"}) + (node_memory_Cached_bytes{job="node-exporter-job"} or node_memory_Cached{job="node-exporter-job"})\n'})}),"\n",(0,t.jsx)(s.h4,{id:"cpu-usage-above-40",children:"CPU Usage above 40%"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 4: More than 40% of computation resources used\nbelow 4: Less than 40% of computation resources used\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"CPU Usage above 40% Metric",src:n(7464).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'sum(irate(node_cpu_seconds_total{mode="user",job="node-exporter-job"}[5m])) or sum(irate(node_cpu{mode="user",job="node-exporter-job"}[5m]))\n'})}),"\n",(0,t.jsx)(s.h4,{id:"disk-usage-above-60",children:"Disk Usage above 60%"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 0,6: Disk more than 60% occupied by tasks\nbelow 0,6: Disk less than 60% occupied by tasks\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Disk Usage above 60% Metric",src:n(9443).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'(sum(node_filesystem_size_bytes{job="node-exporter-job"})-sum(node_filesystem_avail_bytes{job="node-exporter-job"}))/sum(node_filesystem_size_bytes{job="node-exporter-job"})\n'})}),"\n",(0,t.jsx)(s.h4,{id:"cpu-temperature-above-75-c",children:"CPU Temperature above 75 \xb0C"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 75: Processor is running hot\nbelow 75: Processor is running normally\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"CPU Temperature above 75 \xb0C Metric",src:n(9610).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'node_hwmon_temp_celsius{chip="platform_coretemp_0",job="node-exporter-job",sensor="temp1"}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"google-ping-above-30ms",children:"Google Ping above 30ms"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"above 0,03: Connection takes longer than 30ms, not ideal\nbelow 0,03: Connection takes less than 30ms, everything alright\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Google Ping above 30ms Metric",src:n(1669).A+"",width:"1391",height:"844"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:'probe_duration_seconds{job="google-ping-job"}\n'})}),"\n",(0,t.jsx)(s.h2,{id:"1-configuring-notfication-intervals",children:"1. Configuring Notfication Intervals"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Head over to the ",(0,t.jsx)(s.code,{children:"Alerting"})," section on the left menu."]}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.code,{children:"Notification policies"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Click the 3-dot-menu on the default notification channel."}),"\n",(0,t.jsxs)(s.li,{children:["Choose ",(0,t.jsx)(s.code,{children:"Edit"})," within the popup."]}),"\n",(0,t.jsxs)(s.li,{children:["Expand the ",(0,t.jsx)(s.code,{children:"Timing Options"})," field"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The window should look similar to this one, to send one notification every 5 minutes and refresh existing errors every 10 minutes. Grafana 9 will also send you and ",(0,t.jsx)(s.code,{children:"resolved"})," message if the alarm is not present anymore."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Grafana Alert Interval",src:n(44).A+"",width:"1275",height:"823"})})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1669:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-14-dbe613033b35f5bf673048c6355c0059.png"},3128:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-4-ab08bb337950f03dfe833e004dc7ebf0.png"},7333:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-1-1391fa8b4a87b8bd421b078da6ae088d.png"},7464:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-11-fadf80ae175d7ad80088abe786c61c58.png"},7601:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-2-ad062ff81b1b54e12f738d3193090648.png"},8295:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-3-898282200860cb887abf8789a4648993.png"},8403:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-7-ed6ec4dd32bfcea2eb42cd8db2ff9b6e.png"},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>r});var a=n(6540);const t={},o=a.createContext(t);function i(e){const s=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(o.Provider,{value:s},e.children)}},9443:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-12-d900fba8315f08cb50db97de8252a89c.png"},9505:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-10-e72e96f53466ffaace7a3c535acb6bed.png"},9610:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/grafana-alerts-13-d910be5aaf9719593d623e7977a5e897.png"}}]);